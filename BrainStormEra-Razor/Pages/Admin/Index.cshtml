@page "/admin"
@model BrainStormEra_Razor.Pages.Admin.IndexModel
@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin/dashboard.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
}

<div class="admin-dashboard">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="header-left">
            <h1><i class="fas fa-chart-line"></i> Admin Dashboard</h1>
            <p class="header-subtitle">Comprehensive analytics and system overview</p>
        </div>
        <div class="header-right">
            <div class="admin-info">
                <div class="admin-avatar">
                    <img src="@Model.DashboardData.AdminImage" alt="Admin Avatar" 
                         onerror="this.onerror=null; this.src='/SharedMedia/defaults/default-avatar.svg';" />
                </div>
                <div class="admin-details">
                    <span class="admin-name">Welcome, @Model.AdminName</span>
                    <span class="login-time">Last login: @Model.LoginTime.ToString("MMM dd, yyyy HH:mm")</span>
                </div>
            </div>
            <div class="header-actions">
                <button type="button" class="refresh-btn" onclick="refreshDashboard()" title="Refresh Dashboard">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button type="button" class="export-btn" onclick="exportData()" title="Export Data">
                    <i class="fas fa-download"></i>
                </button>
                <a href="/auth/logout" class="btn-logout" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Stats Cards -->
    <div class="quick-stats">
        <div class="stat-card users">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">@Model.DashboardData.TotalUsers.ToString("N0")</div>
                <div class="stat-label">Total Users</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i> +12% from last month
                </div>
            </div>
        </div>

        <div class="stat-card courses">
            <div class="stat-icon">
                <i class="fas fa-book"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">@Model.DashboardData.TotalCourses.ToString("N0")</div>
                <div class="stat-label">Total Courses</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i> +8% from last month
                </div>
            </div>
        </div>

        <div class="stat-card enrollments">
            <div class="stat-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">@Model.DashboardData.TotalEnrollments.ToString("N0")</div>
                <div class="stat-label">Total Enrollments</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i> +25% from last month
                </div>
            </div>
        </div>

        <div class="stat-card revenue">
            <div class="stat-icon">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">$@Model.DashboardData.TotalRevenue.ToString("N0")</div>
                <div class="stat-label">Total Revenue</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i> +18% from last month
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Filters -->
    <div class="dashboard-filters">
        <div class="filter-header">
            <h3><i class="fas fa-filter"></i> Analytics Filters</h3>
            <button type="button" class="filter-toggle" onclick="toggleFilters()">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div class="filter-content">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="filterYear"><i class="fas fa-calendar-alt"></i> Year:</label>
                    <select id="filterYear" asp-for="FilterYear">
                        <option value="">All Years</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterMonth"><i class="fas fa-calendar"></i> Month:</label>
                    <select id="filterMonth" asp-for="FilterMonth">
                        <option value="">All Months</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterCategory"><i class="fas fa-tag"></i> Category:</label>
                    <select id="filterCategory" asp-for="FilterCategory">
                        <option value="">All Categories</option>
                        <option value="programming">Programming</option>
                        <option value="design">Design</option>
                        <option value="business">Business</option>
                        <option value="marketing">Marketing</option>
                        <option value="language">Language</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button type="button" class="apply-filters-btn" onclick="applyFilters()">
                        <i class="fas fa-search"></i> Apply Filters
                    </button>
                    <button type="button" class="clear-filters-btn" onclick="clearFilters()">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
        <!-- User Analytics Chart -->
        <div class="chart-container users-chart" data-chart="users">
            <div class="chart-header">
                <div class="chart-title-section">
                    <h3 class="chart-title">
                        <i class="fas fa-users chart-icon"></i>
                        User Analytics
                    </h3>
                    <p class="chart-subtitle">User distribution and growth trends</p>
                </div>
                <div class="chart-actions">
                    <button class="chart-action-btn" onclick="refreshChart('users')" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="chart-action-btn" onclick="exportChart('users')" title="Export">
                        <i class="fas fa-download"></i>
                    </button>
                    <div class="chart-view-toggle">
                        <button class="view-btn active" data-view="pie" onclick="changeChartView('users', 'pie')">Pie</button>
                        <button class="view-btn" data-view="bar" onclick="changeChartView('users', 'bar')">Bar</button>
                    </div>
                </div>
            </div>
            <div class="chart-stats">
                <div class="stat-item learners">
                    <div class="stat-icon"><i class="fas fa-user-graduate"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.TotalLearners</p>
                        <p class="stat-label">Learners</p>
                    </div>
                </div>
                <div class="stat-item instructors">
                    <div class="stat-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.TotalInstructors</p>
                        <p class="stat-label">Instructors</p>
                    </div>
                </div>
                <div class="stat-item admins">
                    <div class="stat-icon"><i class="fas fa-user-shield"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.TotalAdmins</p>
                        <p class="stat-label">Admins</p>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="usersChart" class="chart-canvas"></canvas>
                <div class="chart-loading" id="usersChartLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading chart data...</p>
                </div>
            </div>
        </div>

        <!-- Course Analytics Chart -->
        <div class="chart-container courses-chart" data-chart="courses">
            <div class="chart-header">
                <div class="chart-title-section">
                    <h3 class="chart-title">
                        <i class="fas fa-book chart-icon"></i>
                        Course Analytics
                    </h3>
                    <p class="chart-subtitle">Course status distribution and enrollment trends</p>
                </div>
                <div class="chart-actions">
                    <button class="chart-action-btn" onclick="refreshChart('courses')" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="chart-action-btn" onclick="exportChart('courses')" title="Export">
                        <i class="fas fa-download"></i>
                    </button>
                    <div class="chart-view-toggle">
                        <button class="view-btn active" data-view="bar" onclick="changeChartView('courses', 'bar')">Bar</button>
                        <button class="view-btn" data-view="line" onclick="changeChartView('courses', 'line')">Line</button>
                    </div>
                </div>
            </div>
            <div class="chart-stats">
                <div class="stat-item approved">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.ApprovedCourses</p>
                        <p class="stat-label">Approved</p>
                    </div>
                </div>
                <div class="stat-item pending">
                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.PendingCourses</p>
                        <p class="stat-label">Pending</p>
                    </div>
                </div>
                <div class="stat-item rejected">
                    <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.RejectedCourses</p>
                        <p class="stat-label">Rejected</p>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="coursesChart" class="chart-canvas"></canvas>
                <div class="chart-loading" id="coursesChartLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading chart data...</p>
                </div>
            </div>
        </div>

        <!-- Certificate Analytics Chart -->
        <div class="chart-container certificates-chart" data-chart="certificates">
            <div class="chart-header">
                <div class="chart-title-section">
                    <h3 class="chart-title">
                        <i class="fas fa-certificate chart-icon"></i>
                        Certificate Analytics
                    </h3>
                    <p class="chart-subtitle">Certificate issuance trends and completion rates</p>
                </div>
                <div class="chart-actions">
                    <button class="chart-action-btn" onclick="refreshChart('certificates')" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="chart-action-btn" onclick="exportChart('certificates')" title="Export">
                        <i class="fas fa-download"></i>
                    </button>
                    <div class="chart-view-toggle">
                        <button class="view-btn active" data-view="line" onclick="changeChartView('certificates', 'line')">Line</button>
                        <button class="view-btn" data-view="area" onclick="changeChartView('certificates', 'area')">Area</button>
                    </div>
                </div>
            </div>
            <div class="chart-stats">
                <div class="stat-item total">
                    <div class="stat-icon"><i class="fas fa-certificate"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.TotalCertificates</p>
                        <p class="stat-label">Total Certificates</p>
                    </div>
                </div>
                <div class="stat-item valid">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.ValidCertificates</p>
                        <p class="stat-label">Valid</p>
                    </div>
                </div>
                <div class="stat-item expired">
                    <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.ExpiredCertificates</p>
                        <p class="stat-label">Expired</p>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="certificatesChart" class="chart-canvas"></canvas>
                <div class="chart-loading" id="certificatesChartLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading chart data...</p>
                </div>
            </div>
        </div>

        <!-- Points Analytics Chart -->
        <div class="chart-container points-chart" data-chart="points">
            <div class="chart-header">
                <div class="chart-title-section">
                    <h3 class="chart-title">
                        <i class="fas fa-star chart-icon"></i>
                        Points Analytics
                    </h3>
                    <p class="chart-subtitle">Point distribution and earning trends</p>
                </div>
                <div class="chart-actions">
                    <button class="chart-action-btn" onclick="refreshChart('points')" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="chart-action-btn" onclick="exportChart('points')" title="Export">
                        <i class="fas fa-download"></i>
                    </button>
                    <div class="chart-view-toggle">
                        <button class="view-btn active" data-view="bar" onclick="changeChartView('points', 'bar')">Bar</button>
                        <button class="view-btn" data-view="doughnut" onclick="changeChartView('points', 'doughnut')">Donut</button>
                    </div>
                </div>
            </div>
            <div class="chart-stats">
                <div class="stat-item total-points">
                    <div class="stat-icon"><i class="fas fa-star"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.TotalPointsInSystem.ToString("N0")</p>
                        <p class="stat-label">Total Points</p>
                    </div>
                </div>
                <div class="stat-item avg-points">
                    <div class="stat-icon"><i class="fas fa-chart-bar"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@Model.DashboardData.AverageUserPoints.ToString("N0")</p>
                        <p class="stat-label">Average Points</p>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="pointsChart" class="chart-canvas"></canvas>
                <div class="chart-loading" id="pointsChartLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading chart data...</p>
                </div>
            </div>
        </div>

        <!-- Chatbot Analytics Chart -->
        <div class="chart-container chatbot-chart" data-chart="chatbot">
            <div class="chart-header">
                <div class="chart-title-section">
                    <h3 class="chart-title">
                        <i class="fas fa-robot chart-icon"></i>
                        Chatbot Analytics
                    </h3>
                    <p class="chart-subtitle">Usage patterns and engagement metrics</p>
                </div>
                <div class="chart-actions">
                    <button class="chart-action-btn" onclick="refreshChart('chatbot')" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="chart-action-btn" onclick="exportChart('chatbot')" title="Export">
                        <i class="fas fa-download"></i>
                    </button>
                    <div class="chart-view-toggle">
                        <button class="view-btn active" data-view="line" onclick="changeChartView('chatbot', 'line')">Line</button>
                        <button class="view-btn" data-view="bar" onclick="changeChartView('chatbot', 'bar')">Bar</button>
                    </div>
                </div>
            </div>
            <div class="chart-stats">
                <div class="stat-item conversations">
                    <div class="stat-icon"><i class="fas fa-comments"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@(Model.DashboardData.ChatbotStatistics.ContainsKey("TotalConversations") ? 
                                                    Model.DashboardData.ChatbotStatistics["TotalConversations"] : 0)</p>
                        <p class="stat-label">Conversations</p>
                    </div>
                </div>
                <div class="stat-item messages">
                    <div class="stat-icon"><i class="fas fa-envelope"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@(Model.DashboardData.ChatbotStatistics.ContainsKey("TotalMessages") ? 
                                                    Model.DashboardData.ChatbotStatistics["TotalMessages"] : 0)</p>
                        <p class="stat-label">Messages</p>
                    </div>
                </div>
                <div class="stat-item satisfaction">
                    <div class="stat-icon"><i class="fas fa-thumbs-up"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">@(Model.DashboardData.ChatbotStatistics.ContainsKey("SatisfactionRate") ? 
                                                    Model.DashboardData.ChatbotStatistics["SatisfactionRate"] : "N/A")</p>
                        <p class="stat-label">Satisfaction</p>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="chatbotChart" class="chart-canvas"></canvas>
                <div class="chart-loading" id="chatbotChartLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading chart data...</p>
                </div>
            </div>
        </div>

        <!-- Revenue Analytics Chart -->
        <div class="chart-container revenue-chart" data-chart="revenue">
            <div class="chart-header">
                <div class="chart-title-section">
                    <h3 class="chart-title">
                        <i class="fas fa-dollar-sign chart-icon"></i>
                        Revenue Analytics
                    </h3>
                    <p class="chart-subtitle">Revenue trends and financial performance</p>
                </div>
                <div class="chart-actions">
                    <button class="chart-action-btn" onclick="refreshChart('revenue')" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="chart-action-btn" onclick="exportChart('revenue')" title="Export">
                        <i class="fas fa-download"></i>
                    </button>
                    <div class="chart-view-toggle">
                        <button class="view-btn active" data-view="line" onclick="changeChartView('revenue', 'line')">Line</button>
                        <button class="view-btn" data-view="bar" onclick="changeChartView('revenue', 'bar')">Bar</button>
                    </div>
                </div>
            </div>
            <div class="chart-stats">
                <div class="stat-item total-revenue">
                    <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                    <div class="stat-details">
                        <p class="stat-value">$@Model.DashboardData.TotalRevenue.ToString("N0")</p>
                        <p class="stat-label">Total Revenue</p>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="revenueChart" class="chart-canvas"></canvas>
                <div class="chart-loading" id="revenueChartLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading chart data...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity Section -->
    <div class="recent-activity-section">
        <div class="activity-header">
            <h3><i class="fas fa-clock"></i> Recent Activity</h3>
            <div class="activity-tabs">
                <button class="tab-btn active" onclick="showActivityTab('users')">Recent Users</button>
                <button class="tab-btn" onclick="showActivityTab('courses')">Recent Courses</button>
            </div>
        </div>

        <div class="activity-content">
            <div class="activity-tab-content" id="users-activity">
                <div class="recent-users-list">
                    @foreach (var user in Model.DashboardData.RecentUsers.Take(5))
                    {
                        <div class="user-item">
                            <div class="user-avatar">
                                <img src="@user.UserImage" alt="@user.FullName" />
                            </div>
                            <div class="user-info">
                                <h4>@user.FullName</h4>
                                <p>@user.UserEmail • @user.UserRole</p>
                                <span class="join-date">Joined @user.AccountCreatedAt.ToString("MMM dd, yyyy")</span>
                            </div>
                            <div class="user-status">
                                @if (user.IsBanned)
                                {
                                    <span class="status-badge banned">Banned</span>
                                }
                                else
                                {
                                    <span class="status-badge active">Active</span>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="activity-tab-content" id="courses-activity" style="display: none;">
                <div class="recent-courses-list">
                    @foreach (var course in Model.DashboardData.RecentCourses.Take(5))
                    {
                        <div class="course-item">
                            <div class="course-image">
                                <img src="@course.CourseImage" alt="@course.CourseName" />
                            </div>
                            <div class="course-info">
                                <h4>@course.CourseName</h4>
                                <p>@(course.Description ?? "No description available")</p>
                                <span class="course-meta">Author: @course.CreatedBy</span>
                            </div>
                            <div class="course-status">
                                <span class="status-badge @(course.ApprovalStatus?.ToLower() ?? "pending")">@(course.ApprovalStatus ?? "Pending")</span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Chart.js with plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
    
    <!-- Dashboard data injection -->
    <script>
        window.dashboardData = @Html.Raw(Json.Serialize(Model.DashboardData));
        window.userId = '@Model.UserId';
        
        // Chart.js configuration
        Chart.defaults.font.family = "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";
        Chart.defaults.font.size = 12;
        Chart.defaults.color = '#64748b';
    </script>
    
    <!-- Dashboard JavaScript -->
    <script src="~/js/admin/dashboard.js" asp-append-version="true"></script>
}
